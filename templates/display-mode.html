<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SoundDash Modo de Apresentação</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #000;
      color: #fff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow-x: hidden;
    }

    .display-container {
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px 0;
      border-bottom: 2px solid #333;
    }

    .header h1 {
      color: #26a69a;
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 0 0 10px rgba(38, 166, 154, 0.3);
    }

    .charts-grid {
      display: grid;
      gap: 30px;
      flex: 1;
      grid-template-columns: 1fr;
      align-content: start;
    }

    .chart-section {
      background-color: #111;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      border: 1px solid #333;
      transition: all 0.3s ease;
    }

    .chart-section:hover {
      border-color: #26a69a;
      box-shadow: 0 4px 25px rgba(38, 166, 154, 0.2);
    }

    .chart-title {
      font-size: 1.5rem;
      color: #26a69a;
      margin-bottom: 15px;
      text-align: center;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .chart-frame {
      width: 100%;
      height: 400px;
      border: none;
      border-radius: 8px;
      background-color: #000;
      display: block;
    }

    .frequency-chart-frame,
    .spectogram-chart-frame {
      height: 350px;
    }

    /* Styles for the gauges section */
    .gauges-section {
      background-color: #111;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      border: 1px solid #333;
      transition: all 0.3s ease;
    }

    .gauges-section:hover {
      border-color: #26a69a;
      box-shadow: 0 4px 25px rgba(38, 166, 154, 0.2);
    }

    .gauges-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      align-items: center;
    }

    .gauge-frame {
      width: 100%;
      height: 200px;
      border: none;
      border-radius: 8px;
      background-color: #000;
      display: block;
    }

    .controls-bar {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 1000;
    }

    .control-btn {
      background-color: rgba(38, 166, 154, 0.9);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .control-btn:hover {
      background-color: rgba(38, 166, 154, 1);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(38, 166, 154, 0.4);
    }

    .fullscreen-btn {
      background-color: rgba(220, 53, 69, 0.9);
    }

    .fullscreen-btn:hover {
      background-color: rgba(220, 53, 69, 1);
      box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
    }

    .status-bar {
      position: fixed;
      bottom: 20px;
      left: 20px;
      right: 20px;
      background-color: rgba(17, 17, 17, 0.95);
      padding: 15px 25px;
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #333;
      backdrop-filter: blur(10px);
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #aaa;
      font-size: 0.9rem;
    }

    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #26a69a;
    }

    .error-message {
      background-color: rgba(220, 53, 69, 0.1);
      border: 1px solid rgba(220, 53, 69, 0.3);
      color: #ff6b6b;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      margin: 20px 0;
    }

    @media (min-width: 1200px) {
      .charts-grid {
        grid-template-columns: 1fr 1fr;
      }
      .chart-section:first-child {
        grid-column: 1 / -1;
      }
      .gauges-section {
        grid-column: 1 / -1;
      }
    }

    @media (max-width: 1024px) {
      .gauges-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      .gauge-frame {
        height: 180px;
      }
    }

    @media (max-width: 768px) {
      .display-container {
        padding: 10px;
      }
      .header h1 {
        font-size: 2rem;
      }
      .controls-bar {
        position: relative;
        top: auto;
        right: auto;
        justify-content: center;
        margin-bottom: 20px;
      }
      .status-bar {
        position: relative;
        bottom: auto;
        left: auto;
        right: auto;
        margin-top: 20px;
        flex-direction: column;
        gap: 10px;
      }
      .gauges-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      .gauge-frame {
        height: 200px;
      }
    }
  </style>
</head>
<body>
  <div class="display-container">
    <div class="header">
      <h1>SoundDash Display</h1>
    </div>

    <div class="controls-bar">
      <button class="control-btn fullscreen-btn" onclick="toggleFullscreen()">⛶ Fullscreen</button>
      <button class="control-btn" onclick="window.close()">✕ Close</button>
    </div>

    <div class="charts-grid">
      <div class="chart-section">
        <div class="chart-title" id="main-chart-title">{{ parameter }} - Sensor {{ sensor }}</div>
        <iframe id="main-chart" class="chart-frame"></iframe>
      </div>

      <div class="chart-section" id="frequency-section">
        <div class="chart-title">Análise de Frequência</div>
        <iframe id="frequency-chart" class="chart-frame frequency-chart-frame"></iframe>
      </div>

      <div class="chart-section" id="spectogram-section">
        <div class="chart-title">Espectrograma</div>
        <iframe id="spectogram-chart" class="chart-frame spectogram-chart-frame"></iframe>
      </div>

      <div class="gauges-section">
        <div class="chart-title">Sound Level Gauges</div>
        <div class="gauges-grid">
          <iframe id="laeq-gauge" class="gauge-frame"></iframe>
          <iframe id="lamax-gauge" class="gauge-frame"></iframe>
          <iframe id="lcpeak-gauge" class="gauge-frame"></iframe>
          <iframe id="lafmin-gauge" class="gauge-frame"></iframe>
        </div>
      </div>
    </div>

    <div class="status-bar">
      <div class="status-item">
        <div class="status-indicator"></div>
        <span>Modo de Apresentação Ativo</span>
      </div>
      <div class="status-item" id="last-update">
        Last Update: {{ current_time }}
      </div>
      <div class="status-item" id="data-points">
        Sensor: {{ sensor }}
      </div>
    </div>
  </div>

  <script>
    const currentSensor = "{{ sensor }}";
    const currentParameter = "{{ parameter }}";
    const currentInterval = "{{ interval }}";

    function getIntervalLabel(interval) {
      const labels = {
        '5m': '5 Minutes',
        '1h': '1 Hour',
        '1d': '1 Day',
        '1w': '1 Week',
        '1mo': '1 Month'
      };
      return labels[interval] || interval;
    }

    function initializeDisplay() {
      if (!currentSensor) {
        showError("Nenhum sensor especificado. Por favor, volte à página principal e selecione um sensor.");
        return;
      }
      loadCharts();
    }

    async function loadCharts() {
      try {
        const now = Date.now();
        let from = calculateFromTime(now, currentInterval);
        await loadMainChart(from, now);
        await loadFrequencyChart();
        await loadSpectogramChart();
        await loadGauges(from, now);
        updateLastUpdateTime();
      } catch (error) {
        console.error("Error loading charts:", error);
        showError("Failed to load chart data.");
      }
    }

    function calculateFromTime(now, interval) {
      switch (interval) {
        case '1h': return now - 60 * 60 * 1000;
        case '1d': return now - 24 * 60 * 60 * 1000;
        case '1w': return now - 7 * 24 * 60 * 60 * 1000;
        case '1mo': return now - 30 * 24 * 60 * 60 * 1000;
        case '5m':
        default: return now - 5 * 60 * 1000;
      }
    }

    async function loadMainChart(from, to) {
      const baseUrls = {
        four_metrics: "http://localhost:3000/d-solo/cerw46cubqbk0b/4-metrcis",
        LAEA: "http://localhost:3000/d-solo/eej0pdkup3rpce/laea",
        LAeq: "http://localhost:3000/d-solo/dej0r21ki3ri8e/laeq",
        LCpeak: "http://localhost:3000/d-solo/fej0qrt2av8qod/lcpeak",
        LAmin: "http://localhost:3000/d-solo/eej2n5j54d1c0a/lafmin",
        LAmax: "http://localhost:3000/d-solo/eej0qhnp8j5s0b/lafmax",
        LCpeakT: "http://localhost:3000/d-solo/bej0rd0dtua68d/lcpeakt",
        LAmaxT: "http://localhost:3000/d-solo/fej2mx82t08hsc/lafmaxt",
        LAminT: "http://localhost:3000/d-solo/eej2nbqw1xm9sf/lafmint"
      };

      const selectedUrl = baseUrls[currentParameter] || baseUrls['LAEA'];
      const iframe = document.getElementById('main-chart');
      iframe.src = `${selectedUrl}?orgId=1&from=${from}&to=${to}&timezone=browser&var-sensors=${currentSensor}&panelId=1&__feature.dashboardSceneSolo&theme=dark`;
    }

    async function loadFrequencyChart() {
      const iframe = document.getElementById('frequency-chart');
      iframe.src = "http://localhost:3000/d-solo/demjmzz4e6uwwe/frequency-band?orgId=1&from=1745230740651&to=1747822740651&timezone=browser&panelId=1&__feature.dashboardSceneSolo&theme=dark";
    }

    async function loadSpectogramChart() {
      const baseUrl = "http://localhost:3000/d-solo/een6a6zegi1hca/spectogram";
      const now = Date.now();
      const from = calculateFromTime(now, currentInterval);
      const iframe = document.getElementById('spectogram-chart');
      iframe.src = `${baseUrl}?orgId=1&from=${from}&to=${now}&timezone=browser&var-sensors=${currentSensor}&panelId=1&__feature.dashboardSceneSolo&theme=dark`;
    }

    async function loadGauges(from, to) {
      const gaugeConfigs = [
        {
          id: 'laeq-gauge',
          url: 'http://localhost:3000/d-solo/feq8gmvbc3k00c/laeq-gauge'
        },
        {
          id: 'lamax-gauge',
          url: 'http://localhost:3000/d-solo/beq8kx46ans3kc/lamax-gauge'
        },
        {
          id: 'lcpeak-gauge',
          url: 'http://localhost:3000/d-solo/eeq8kgqqupv5se/lcpeak-gauge'
        },
        {
          id: 'lafmin-gauge',
          url: 'http://localhost:3000/d-solo/ceq8la36crda8b/lafmin-gauge'
        }
      ];

      gaugeConfigs.forEach(gauge => {
        const iframe = document.getElementById(gauge.id);
        iframe.src = `${gauge.url}?orgId=1&from=${from}&to=${to}&timezone=browser&var-sensors=${currentSensor}&panelId=1&__feature.dashboardSceneSolo&theme=dark`;
      });
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.log(`Error attempting to enable fullscreen: ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
    }

    function updateLastUpdateTime() {
      const now = new Date();
      document.getElementById('last-update').textContent = `Last Update: ${now.toLocaleTimeString()}`;
    }

    function showError(message) {
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';
      errorDiv.textContent = message;
      const container = document.querySelector('.display-container');
      container.insertBefore(errorDiv, container.querySelector('.charts-grid'));
    }

    document.addEventListener('fullscreenchange', function() {
      const btn = document.querySelector('.fullscreen-btn');
      btn.textContent = document.fullscreenElement ? '⛶ Exit Fullscreen' : '⛶ Fullscreen';
    });

    document.addEventListener('DOMContentLoaded', initializeDisplay);
  </script>
</body>
</html>